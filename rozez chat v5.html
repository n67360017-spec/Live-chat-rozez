<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ROZEZ OFFICIAL - Request Chat</title>
  <style>
    :root {
      --accent: #ff4f9a;
      --text: #fff;
      --card: rgba(20,20,40,0.6);
      --bubble-user: #ff4f9a;
      --bubble-bot: rgba(0,0,0,0.6);
      --bubble-admin: #4a90e2;
    }

    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: url("https://files.catbox.moe/88nt8o.jpg") center/cover no-repeat;
      background-attachment: fixed;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }

    .app {
      width: 95%;
      max-width: 450px;
      height: 92vh;
      border-radius: 22px;
      backdrop-filter: blur(14px) saturate(180%);
      background: var(--card);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      box-shadow: 0 6px 30px rgba(0,0,0,0.7);
    }

    /* Header */
    .status-bar {
      display: flex;
      align-items: center;
      padding: 12px;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.15);
      position: relative;
    }

    .status-bar img {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      padding: 2px;
      object-fit: cover;
    }

    .status-info {
      flex: 1;
    }

    .status-info h4 {
      margin: 0;
      font-size: 15px;
    }

    .status-info p {
      margin: 0;
      font-size: 12px;
      color: #ddd;
    }

    /* Chat */
    .chat-box {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .bubble {
      max-width: 75%;
      padding: 10px 14px;
      margin: 6px 0;
      border-radius: 18px;
      font-size: 14px;
      animation: fadeIn 0.3s ease;
      word-wrap: break-word;
    }

    .bubble img, .bubble video {
      max-width: 100%;
      border-radius: 12px;
      margin-bottom: 6px;
    }

    .user {
      align-self: flex-end;
      background: var(--bubble-user);
      color: #fff;
    }

    .bot {
      align-self: flex-start;
      background: var(--bubble-bot);
      color: #fff;
    }

    .admin {
      align-self: flex-start;
      background: var(--bubble-admin);
      color: #fff;
    }

    .message-info {
      font-size: 10px;
      opacity: 0.7;
      margin-top: 4px;
      text-align: right;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .notification {
      animation: pulse 1s infinite;
      background-color: var(--accent);
      border-radius: 50%;
      width: 8px;
      height: 8px;
      position: absolute;
      top: 10px;
      right: 10px;
    }

    /* Input */
    .input-area {
      display: flex;
      flex-direction: column;
      padding: 10px;
      border-top: 1px solid rgba(255,255,255,0.15);
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(10px);
      gap: 8px;
    }

    .input-area input[type="text"] {
      padding: 10px;
      border: none;
      border-radius: 14px;
      outline: none;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-family: "Poppins", sans-serif;
    }

    .input-area input::placeholder {
      color: #aaa;
    }

    .input-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .input-area input[type="file"] {
      display: none;
    }

    .input-area label {
      background: var(--accent);
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      color: #fff;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .input-area label:hover {
      background: #ff2d87;
      transform: scale(1.05);
    }

    .input-area button {
      padding: 10px 14px;
      border: none;
      border-radius: 14px;
      background: var(--accent);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      font-family: "Poppins", sans-serif;
    }

    .input-area button:hover {
      background: #ff2d87;
      transform: translateY(-2px);
    }

    .input-area button:active {
      transform: translateY(0);
    }

    .input-area button:disabled {
      background: #888;
      cursor: not-allowed;
      transform: none;
    }

    /* Hamburger */
    .hamburger {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 25px;
      height: 20px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      z-index: 1000;
    }

    .hamburger div {
      background: var(--text);
      height: 3px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .hamburger:hover div {
      background: var(--accent);
    }

    .menu {
      display: none;
      position: absolute;
      top: 60px;
      right: 15px;
      background: rgba(0,0,0,0.85);
      padding: 12px;
      border-radius: 14px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.6);
      z-index: 999;
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease;
    }

    .menu button {
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      border: none;
      border-radius: 10px;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: "Poppins", sans-serif;
    }

    .menu button:hover {
      background: #ff2d87;
      transform: translateX(-5px);
    }

    /* Loading indicator */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <div class="status-bar">
      <img src="https://files.catbox.moe/88nt8o.jpg" alt="Owner">
      <div class="status-info">
        <h4>ROZEZ OFFICIAL</h4>
        <p>Online sekarang</p>
      </div>
      <div id="notification" class="notification" style="display: none;"></div>
    </div>

    <!-- Menu -->
    <div class="hamburger" id="hamburger">
      <div></div><div></div><div></div>
    </div>

    <div class="menu" id="menu">
      <button id="github-btn">GitHub</button>
      <button id="youtube-btn">YouTube</button>
      <button id="telegram-btn">Telegram</button>
      <button id="channel-btn">Channel Information</button>
      <button id="music-btn">🎵 Music On/Off</button>
      <button id="refresh-btn">🔄 Periksa Balasan</button>
    </div>

    <!-- Chat -->
    <div class="chat-box" id="chat-box">
      <div class="bubble bot">( 👋 ) Halo, isi username dulu lalu kirim request (bisa teks + foto/video)!</div>
    </div>

    <!-- Input -->
    <div class="input-area">
      <input type="text" id="username" placeholder="Masukkan Username Telegram (@username)">
      <div class="input-row">
        <label for="fileInput">+</label>
        <input type="file" id="fileInput" accept="image/*,video/*">
        <input type="text" id="userMessage" placeholder="Tulis pesan...">
        <button id="send-btn">Kirim</button>
      </div>
    </div>
  </div>

  <!-- Music -->
  <audio id="bgMusic" loop>
    <source src="https://files.catbox.moe/b1swuo.mp3" type="audio/mpeg">
  </audio>

  <script>
    // Inisialisasi elemen DOM
    const chatBox = document.getElementById("chat-box");
    const menu = document.getElementById("menu");
    const fileInput = document.getElementById("fileInput");
    const music = document.getElementById("bgMusic");
    const notification = document.getElementById("notification");
    const hamburger = document.getElementById("hamburger");
    const sendBtn = document.getElementById("send-btn");
    const userMessageInput = document.getElementById("userMessage");
    const usernameInput = document.getElementById("username");

    // Konstanta untuk Telegram Bot API
    const BOT_TOKEN = "8352348723:AAF8NlCd-BDvIOD543vG039Ji3opLdG8ycg";
    const CHAT_ID = "8052454369";
    
    // Variabel untuk menyimpan data pesan
    let sentMessages = [];
    let lastMessageId = 0;
    let replyCheckInterval;

    // Event Listeners untuk tombol
    document.addEventListener('DOMContentLoaded', function() {
      // Tombol menu
      hamburger.addEventListener('click', toggleMenu);
      
      // Tombol kirim
      sendBtn.addEventListener('click', sendMessage);
      
      // Tombol menu dropdown
      document.getElementById('github-btn').addEventListener('click', () => openLink('https://github.com/Ertaxtzy'));
      document.getElementById('youtube-btn').addEventListener('click', () => openLink('https://youtube.com/Ovcynaa'));
      document.getElementById('telegram-btn').addEventListener('click', () => openLink('https://t.me/KING_ROZEZ'));
      document.getElementById('channel-btn').addEventListener('click', () => openLink('https://t.me/KING_ROZEZ_INFO'));
      document.getElementById('music-btn').addEventListener('click', toggleMusic);
      document.getElementById('refresh-btn').addEventListener('click', checkForReplies);
      
      // Event listener untuk input file
      document.querySelector('label[for="fileInput"]').addEventListener('click', function() {
        fileInput.click();
      });
      
      // Event listener untuk file input change
      fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
          const file = this.files[0];
          const fileType = file.type.split('/')[0]; // 'image' atau 'video'
          const fileName = file.name;
          
          // Tampilkan pesan bahwa file telah dipilih
          if (fileType === 'image') {
            appendMessage(`📷 Foto dipilih: ${fileName}`, "bot");
          } else if (fileType === 'video') {
            appendMessage(`🎥 Video dipilih: ${fileName}`, "bot");
          } else {
            appendMessage(`📎 File dipilih: ${fileName}`, "bot");
          }
        }
      });
      
      // Event listener untuk tombol Enter
      userMessageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      usernameInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          userMessageInput.focus();
        }
      });
    });

    // Fungsi untuk toggle menu
    function toggleMenu() {
      if (menu.style.display === "block") {
        menu.style.display = "none";
      } else {
        menu.style.display = "block";
      }
    }

    // Fungsi untuk membuka link
    function openLink(url) {
      window.open(url, "_blank");
      menu.style.display = "none";
    }

    // Fungsi untuk toggle musik
    function toggleMusic() {
      if (music.paused) {
        music.play().catch(e => {
          console.log("Autoplay diblokir, silakan klik tombol music lagi");
          appendMessage("❌ Musik tidak dapat diputar otomatis. Silakan klik tombol music lagi.", "bot");
        });
      } else {
        music.pause();
      }
      menu.style.display = "none";
    }

    // Fungsi untuk menambahkan pesan ke chat
    function appendMessage(msg, type, mediaUrl=null, timestamp=null) {
      let div = document.createElement("div");
      div.className = "bubble " + type;
      
      if(mediaUrl){
        const fileType = mediaUrl.type || 'image';
        
        if (fileType.includes('image') || fileType === 'image') {
          const img = document.createElement("img");
          img.src = mediaUrl.url || mediaUrl;
          div.appendChild(img);
        } else if (fileType.includes('video') || fileType === 'video') {
          const video = document.createElement("video");
          video.src = mediaUrl.url || mediaUrl;
          video.controls = true;
          video.style.maxWidth = "100%";
          div.appendChild(video);
        }
      }
      
      if(msg) {
        const textNode = document.createTextNode(msg);
        div.appendChild(textNode);
      }
      
      // Tambahkan info waktu jika tersedia
      if (timestamp) {
        const infoDiv = document.createElement("div");
        infoDiv.className = "message-info";
        infoDiv.textContent = formatTimestamp(timestamp);
        div.appendChild(infoDiv);
      }
      
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Fungsi untuk format timestamp
    function formatTimestamp(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
    }

    // Fungsi untuk menampilkan notifikasi
    function showNotification() {
      notification.style.display = "block";
      setTimeout(() => {
        notification.style.display = "none";
      }, 3000);
    }

    // Fungsi utama untuk mengirim pesan
    async function sendMessage() {
      const username = usernameInput.value.trim();
      const msg = userMessageInput.value.trim();
      const file = fileInput.files[0];

      // Validasi input
      if (!username) {
        appendMessage("⚠️ Harap isi username Telegram Anda terlebih dahulu.", "bot");
        usernameInput.focus();
        return;
      }
      
      if (!msg && !file) {
        appendMessage("⚠️ Harap tulis pesan atau pilih foto/video untuk dikirim.", "bot");
        userMessageInput.focus();
        return;
      }

      // Tampilkan pesan pengguna di chat
      const timestamp = Math.floor(Date.now() / 1000);
      
      // Tentukan jenis media yang akan ditampilkan
      let mediaType = null;
      let mediaUrl = null;
      
      if (file) {
        mediaType = file.type.split('/')[0]; // 'image' atau 'video'
        mediaUrl = {
          url: URL.createObjectURL(file),
          type: mediaType
        };
      }
      
      appendMessage(`${msg || "(hanya media)"}`, "user", mediaUrl, timestamp);
      appendMessage(`👤 @${username}`, "user", null, timestamp);

      // Reset input
      userMessageInput.value = "";
      fileInput.value = "";

      // Tampilkan loading state
      const originalText = sendBtn.innerHTML;
      sendBtn.innerHTML = '<div class="loading"></div>';
      sendBtn.disabled = true;

      try {
        // Format pesan untuk dikirim ke Telegram
        let textTemplate = 
`📩 Request Baru!
👤 Username: @${username}
✏️ Pesan: ${msg || "(hanya media)"}
🆔 ID: ${timestamp}`;

        let messageId;

        // Kirim pesan ke Telegram
        if (file) {
          const formData = new FormData();
          formData.append("chat_id", CHAT_ID);
          formData.append("caption", textTemplate);
          
          // Tentukan apakah ini foto atau video
          if (file.type.includes('image')) {
            formData.append("photo", file);
            
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
              method: "POST",
              body: formData
            });
            
            const result = await response.json();
            if (result.ok) {
              messageId = result.result.message_id;
            }
          } else if (file.type.includes('video')) {
            formData.append("video", file);
            
            const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
              method: "POST",
              body: formData
            });
            
            const result = await response.json();
            if (result.ok) {
              messageId = result.result.message_id;
            }
          }
        } else {
          const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
              chat_id: CHAT_ID, 
              text: textTemplate,
              parse_mode: "HTML"
            })
          });
          
          const result = await response.json();
          if (result.ok) {
            messageId = result.result.message_id;
          }
        }

        // Simpan pesan yang dikirim untuk referensi balasan
        sentMessages.push({
          id: timestamp,
          messageId: messageId,
          username: username,
          text: msg,
          timestamp: timestamp
        });
        
        lastMessageId = timestamp;
        
        appendMessage("✅ Request berhasil dikirim! Admin akan membalas segera.", "bot");
        
        // Mulai polling untuk memeriksa balasan
        if (!replyCheckInterval) {
          startReplyPolling();
        }
        
        // Simulasi balasan untuk demo (hapus di produksi)
        setTimeout(() => {
          appendMessage(
            "👨‍💼 Admin: Terima kasih atas request Anda. Kami akan segera memprosesnya.",
            "admin",
            null,
            Math.floor(Date.now() / 1000)
          );
          showNotification();
        }, 3000);
        
      } catch (e) {
        console.error("Error:", e);
        appendMessage("❌ Gagal mengirim request. Periksa koneksi internet Anda.", "bot");
      } finally {
        // Kembalikan tombol ke state normal
        sendBtn.innerHTML = originalText;
        sendBtn.disabled = false;
      }
    }

    // Fungsi untuk memulai polling balasan
    function startReplyPolling() {
      replyCheckInterval = setInterval(checkForReplies, 10000); // Periksa setiap 10 detik
    }

    // Fungsi untuk memeriksa balasan
    async function checkForReplies() {
      if (sentMessages.length === 0) return;
      
      try {
        // Dapatkan update terbaru dari bot
        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${lastMessageId + 1}`);
        const result = await response.json();
        
        if (result.ok && result.result.length > 0) {
          for (const update of result.result) {
            // Periksa apakah ini adalah balasan untuk pesan kita
            if (update.message && update.message.reply_to_message) {
              const repliedMessageId = update.message.reply_to_message.message_id;
              
              // Cari pesan asli yang dibalas
              const originalMessage = sentMessages.find(msg => msg.messageId === repliedMessageId);
              
              if (originalMessage) {
                // Tampilkan balasan
                appendMessage(
                  `${update.message.text}`,
                  "admin",
                  null,
                  update.message.date
                );
                
                // Perbarui lastMessageId
                lastMessageId = update.update_id;
                
                // Tampilkan notifikasi
                showNotification();
              }
            }
          }
        }
      } catch (e) {
        console.error("Error checking replies:", e);
      }
      
      menu.style.display = "none";
    }
  </script>
</body>
</html>